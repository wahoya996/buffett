# 从零开始打造自己的操作系统
By 王琛
## 序言
第一次认识 Linux 大概应该是15、6的时间吧，那时候上高中看到我哥哥有一次带了一个蓝点 Linux 的系统盘，从此就认识 Linux 了，后来国内有了 Red hat，然后还有 Ubuntu，记得还让它给我邮寄过，那时候大多数花时间在美化、汉化上，基本上软件生态几乎是没有的，基本上还是处于学习阶段。

疫情后居家期间有了时间，又开始捣鼓 Linux 了，试了 arch 和 debian，当前系统的完整度明显有了很大的进步，例如字体有谷歌提供的 Noto，输入法也直接可以用，基本上应用的软件生态都很成熟，国内腾讯的软件稍微差了一点，于是开始摸索自己自定一套自己的系统。

## 自定义操作系统的优点
目前通用的操作系统大致上以三类为主，windows、mac os、linux/unix，前两者都是商业公司开发的也是大多数人使用的，使用效果非常好、软件生态丰富，特别是 windows 家喻户晓，mac 系统这几年随着 iphone 产品的成功，目前发展的也非常好。相对而言，Linux 系统一直还是服务器或者行业用户使用的比较多一些，目前国内软件厂家的适配比较差，例如腾讯系的软件很多不好用，但目前国内政府机关开始要使用国产 linux 系统了，整体来说对于 Linux 的趋势会越来越好。

选择 Linux 系统进行定制，是因为其他两个系统都是商业系统，个人无法进行更改，但是 Linux 丰富的发行版和包管理软件，是个人定制非常好的选择。

比较适合以下应用场景：
- 上网下载、娱乐办公
- 家庭服务器
- 编程开发

不太适合的应用场景：
- 游戏
- 大量依赖 windows 的专有软件，例如炒股、qq 和微信（也有 linux 版，但体验一般）

## 系统选择
arch 和 debian 都是很成熟的软件生态，非常适合自己从头开始定义，debian stable 的软件要老一些，但是自己对 debian 比较熟悉，arch 的软件以新闻名，而且文档丰富，其实两者都可以，但是个人使用要求软件生态还是新一些比较好，所以经过平衡最后选择了 arch。

## 系统安装
这部分内容其实可以参考 arch wiki，有非常详细的安装指南，其实重点就是以下几项内容：
- 硬盘格式化及文件系统的选择，ex4 和 brtfs 都是很好的选择
- 桌面系统的选择，Gnome 和 kde 都是不错的选择，Gnome 比较像 mac，kde 更加像 windows 一些
- 显示构架，推荐显卡用 amd 的，amd 支持比较完善，大多数软件都支持 wayland了
- 启动管理器，可以用 grub 或者 systemd-boot，我比较习惯后者，前者很丑后者更加现代化
- 打印系统，用苹果出的 CUPS 即可，非常方便，只是 air print 还调试不成功
- 扫描仪，用 air-sane 可以实现网络连接
- 蓝牙用 bluz 软件包就可以，具体看 wiki
- 软件包，既然是定制化就是少而精只选合适的
	- 媒体播放器 VLC
	- 浏览器 Chromium 和 edge 都可以
	- BT下载 qbittorrent-nox 不带界面，可以用浏览器很方便
	- 视频会议用 zoom 和腾讯会议（虽有不足，但能用）
	- 笔记软件，可以使用 nvim 记录 markdown 文本，notion 作为网络记事本
	- 办公软件 WPS，使用效果非常好，国产良心
	- 密码管理 Bitwarden
	- 农历 ccal，需要手动编译，但是很方便
	- 文本编辑器，Nvim 很好用，修改下 .zshrc 让 vim=nvim（别名）
	- 社交网络用 telegram，有很好的客户端，wechat 有一个原生的但是效果很差
	- 网络管理器用 networkmanager
	- 系统进程服务器使用 htop，虽然是命令行的但是很方便

## 系统调教
### systemctl 开启关闭服务
利用 systemctl 可以开启关闭服务，例如 cups、networkmanager，工具非常强大能够有效的管理 linux 的启动服务，也可以自己编辑一个服务单元，例如 qbittorrent 实现开机自动启动。

### 中文字体
虽然系统自带的 Noto 字体非常优秀，日常使用已经足够了，对于有公文办公的可以安装 wps-ttf，里面自带了方正的全套字体，足够用了，实在还有雅黑、宋体需求的可以把 windows 系统的拷贝进去，这样基本上文稿交换就没有问题了。

`/usr/share/fonts`

### Latex
Texlive 光盘下面有命令行的安装文件，执行后即可以安装，但是整体文件包非常大，有些发行版例如 debian 也有直接打包的。如果用 Texlive 安装的还需要把 tex 命令加入环境变量，不然很多命令无法执行。

### 文件共享
使用 samba 包，可以进行文件共享（这部分内容待完善）

### 消除电脑耳机接口的电流声
主要是内核驱动intel-hda有一个省电模式，默认开启去掉即可，建立以下文件 `/etc/modprobe.d/audio_disable_powersave.conf` :

`options snd_hda_intel power_save=0`
### 安装打印驱动
我用的打印机是Espon L4168，aur内有驱动

`yay -S epson-inkjet-printer-escpr`

## Linux 的使用感受
Linux 自己也一直反复安装尝试，但是之前都没有成功，今天写这篇指南其实还是有很多感受，从整体来说目前 Linux 系统还是不适合普通人使用的，因为整体的技术门槛太高，发行版零碎化，软件生态不足，而普通人使用电脑就是为了完成特定的任务，这点 windows 和 mac 是更加合适的，不应该选择使用 Linux，这点毋庸置疑。

对于电脑技术比较精通的人，而自己的应用场景需求 Linux 能够满足的人群，那么使用 Linux 可以说是如虎添翼：
- 完全自定义的系统，底层可以完全掌握
- 无需等待商业公司发布及付费
- 强大的社区支持，利用 arch 和 debian 的包管理器，维护成本是较低的，滚动发行版时间成本相对高一点，可以限定为每半个月更新一次
- 系统伸缩性非常好，可以依据自己需求进行动态调正
- 强大的稳定性，对硬件的要求相对较低，一旦打造完成可以使用很长的周期，投入产出价值大
- 打发时间及让自己有成就感～～哈

## 后记
写这篇文章利用了周末一个上午（还是利用开会摸鱼时间），但是酝酿花了很长的时间，自己反反复复安装系统，进行调整不满意又重来，仿佛着魔了一样，真是“念念不忘，必有回响”，写出来也算是对自己这么多工作的一个总结吧。

日期：2022年5月15日
